{"version":3,"sources":["file:///D:/ProgramData/cocos/workplace/Gourmet/assets/script/Recipes/NavigationBar.ts"],"names":["_decorator","Button","Color","Component","instantiate","Label","Node","Prefab","resources","RichText","Sprite","SpriteFrame","UITransform","UIStackManager","ccclass","property","NavigationBar","activeColor","defaultColor","onLoad","goToHome","instance","popUI","pushUI","homePanel","active","ingredientSearchPanel","randomRecipePanel","highlightButton","homeButton","goToIngredientSearch","ingredientSearchButton","goToRandomRecipe","randomRecipeButton","goToDetailPage","recipe","content","removeAllChildren","detailPage","RecipeListitem","RecipeDetail","Fiamge","Foodimage","Rtext1","Rtext2","getChildByName","getComponent","string","name","ingredients","join","seasonings","cooking_methods","load","image","err","spriteFrame","console","error","sprite","texture","originalWidth","width","originalHeight","height","uiTransform","setContentSize","link","horizontalAlign","on","EventType","TOUCH_END","event","extractLinkFromRichText","log","window","open","details","addChild","scheduleOnce","contentUITransform","children","reduce","acc","child","richTextString","match","goBackToPreviousUI","activeButton","setButtonColor","button","color","node"],"mappings":"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","sourcesContent":["import { _decorator, Button, Color, color, Component, director, instantiate, Label, Node, Prefab, resources, RichText, Sprite, SpriteFrame, UITransform } from 'cc';\nimport { UIStackManager } from '../UIStackManager';\nconst { ccclass, property } = _decorator;\n\n@ccclass('NavigationBar')\nexport class NavigationBar extends Component {\n    @property(Node)\n    homePanel: Node = null;\n\n    @property(Node)\n    ingredientSearchPanel: Node = null;\n\n    @property(Node)\n    randomRecipePanel: Node = null\n    @property(Node)\n    navBar: Node = null;\n\n    @property(Node)\n    detailPage: Node = null;\n    @property(Node)\n    content: Node = null;\n    @property(Prefab)\n    RecipeDetail: Node = null;\n    @property(Prefab)\n    RichText: Node = null;\n    @property(Prefab)\n    Foodimage: Node = null;\n    @property(Button)\n    homeButton: Button = null;\n\n    @property(Button)\n    ingredientSearchButton: Button = null;\n\n    @property(Button)\n    randomRecipeButton: Button = null;\n\n    // 当前活动按钮的颜色\n    activeColor: Color = new Color(0, 224, 255); // 00E0FF \n    // 默认按钮颜色\n    defaultColor: Color = new Color(255, 255, 255);  // 默认颜色为白色\n\n    onLoad() {\n        this.goToHome();\n    }\n\n    goToHome() {\n        // 切换到主页逻辑并高亮按钮\n        UIStackManager.instance.popUI();\n        UIStackManager.instance.pushUI(this.homePanel);\n        this.homePanel.active = true;\n        this.ingredientSearchPanel.active = false;\n        this.randomRecipePanel.active = false;\n        this.highlightButton(this.homeButton);\n    }\n\n    goToIngredientSearch() {\n        // 切换到食材检索页面逻辑并高亮按钮\n        UIStackManager.instance.popUI();\n        UIStackManager.instance.pushUI(this.ingredientSearchPanel);\n        this.homePanel.active = false;\n        this.ingredientSearchPanel.active = true;\n        this.randomRecipePanel.active = false;\n        this.highlightButton(this.ingredientSearchButton);\n    }\n\n    goToRandomRecipe() {\n        // 切换到随机食谱页面逻辑并高亮按钮\n        UIStackManager.instance.popUI();\n        UIStackManager.instance.pushUI(this.randomRecipePanel);\n        this.homePanel.active = false;\n        this.ingredientSearchPanel.active = false;\n        this.randomRecipePanel.active = true;\n        this.highlightButton(this.randomRecipeButton);\n    }\n    // 进入详情页面\n    goToDetailPage(recipe : any) {\n        // 清空当前列表\n        this.content.removeAllChildren();\n        UIStackManager.instance.pushUI(this.detailPage);\n        this.detailPage.active = true;\n        this.homePanel.active = false;\n        this.ingredientSearchPanel.active = false;\n        this.randomRecipePanel.active = false;\n        // 实例化节点\n        const RecipeListitem = instantiate(this.RecipeDetail);\n        const Fiamge = instantiate(this.Foodimage);\n        const Rtext1 = instantiate(this.RichText);\n        const Rtext2 = instantiate(this.RichText);\n        // 设置食谱内容\n        RecipeListitem.getChildByName(\"NameLabel\").getComponent(Label).string = recipe.name;\n        RecipeListitem.getChildByName(\"IngredientsLabel\").getComponent(Label).string = `食材：${recipe.ingredients.join(\",\")}`;\n        if(recipe.seasonings != \"\")\n          RecipeListitem.getChildByName(\"SeasoningsLabel\").getComponent(Label).string = `配料：${recipe.seasonings.join(\",\")}`;\n        else {RecipeListitem.getChildByName(\"SeasoningsLabel\").getComponent(Label).string = `配料：无`;}\n        RecipeListitem.getChildByName(\"CookingMethodsLabel\").getComponent(Label).string = `烹饪方式：${recipe.cooking_methods.join(\" 或 \")}`;\n        // 加载并设置图片\n        resources.load(recipe.image, SpriteFrame, (err, spriteFrame) => {\n            if (err) {\n                console.error(\"Failed to load image:\", err);\n                return;\n            }\n            // 获取 Sprite 组件并设置 spriteFrame\n            const sprite = Fiamge.getComponent(Sprite);\n            if (sprite) {\n                sprite.spriteFrame = spriteFrame;\n\n                // 获取图片的原始尺寸\n                const texture = spriteFrame.texture;\n                const originalWidth = texture.width;\n                const originalHeight = texture.height;\n\n                // 获取并调整 UITransform 的尺寸\n                const uiTransform = Fiamge.getComponent(UITransform);\n                if (uiTransform) {\n                    uiTransform.setContentSize(originalWidth*0.5, originalHeight*0.5);\n                }\n            }\n        }); \n        Rtext1.getComponent(RichText).string = recipe.link;\n        Rtext1.getComponent(RichText).horizontalAlign = 1 ;//内容居中\n        // 使用 TOUCH_END 监听点击事件\n        Rtext1.on(Node.EventType.TOUCH_END, (event) => {\n            const link = this.extractLinkFromRichText(Rtext1.getComponent(RichText).string);\n            if (link) {\n                console.log(\"超链接被点击:\", link);\n                if (typeof window !== 'undefined') {\n                    window.open(link, '_blank');\n                }\n            }\n        });\n        Rtext2.getComponent(RichText).string = recipe.details;\n        this.detailPage.addChild(RecipeListitem);\n        this.content.addChild(Fiamge);\n        this.content.addChild(Rtext1);\n        this.content.addChild(Rtext2);\n        // 更新滚动视图内容尺寸\n        this.scheduleOnce(() => {\n            const contentUITransform = this.content.getComponent(UITransform);\n            contentUITransform.height = this.content.children.reduce((acc, child) => acc + child.getComponent(UITransform).height, 0);\n        }, 0);\n    }\n    extractLinkFromRichText(richTextString: string): string | null {\n        // 使用正则表达式匹配 href 属性并提取链接\n        const match = richTextString.match(/href=\"([^\"]+)\"/);\n        return match ? match[1] : null;\n    }\n    // 返回上一个UI\n    goBackToPreviousUI() {\n        this.detailPage.active = false;\n        this.homePanel.active = false;\n        this.ingredientSearchPanel.active = false;\n        this.randomRecipePanel.active = false;\n        UIStackManager.instance.popUI().active = true;  \n    }\n    // 设置按钮高亮，并将其他按钮恢复默认颜色\n    highlightButton(activeButton: Button) {\n        // 重置所有按钮的颜色\n        this.setButtonColor(this.homeButton, this.defaultColor);\n        this.setButtonColor(this.ingredientSearchButton, this.defaultColor);\n        this.setButtonColor(this.randomRecipeButton, this.defaultColor);\n\n        // 设置当前按钮为高亮颜色\n        this.setButtonColor(activeButton, this.activeColor);\n    }\n    setButtonColor(button: Button, color: Color) {\n        const sprite = button.node.getComponent(Sprite);\n        if (sprite) {\n            sprite.color = color;\n        }\n    }\n}\n\n\n"]}