{"version":3,"sources":["file:///D:/ProgramData/cocos/workplace/Gourmet/assets/script/Recipes/NavigationBar.ts"],"names":["_decorator","Button","Color","Component","instantiate","Label","Node","Prefab","resources","RichText","Sprite","SpriteFrame","UITransform","UIStackManager","ccclass","property","NavigationBar","activeColor","defaultColor","onLoad","goToHome","instance","popUI","pushUI","homePanel","active","ingredientSearchPanel","randomRecipePanel","highlightButton","homeButton","goToIngredientSearch","ingredientSearchButton","goToRandomRecipe","randomRecipeButton","goToDetailPage","recipe","content","removeAllChildren","detailPage","RecipeListitem","RecipeDetail","Fiamge","Foodimage","Rtext1","Rtext2","getChildByName","getComponent","string","name","ingredients","join","seasonings","cooking_methods","load","image","err","spriteFrame","console","error","sprite","texture","originalWidth","width","originalHeight","height","uiTransform","setContentSize","link","horizontalAlign","on","EventType","TOUCH_END","event","extractLinkFromRichText","log","window","open","details","addChild","scheduleOnce","contentUITransform","children","reduce","acc","child","richTextString","match","goBackToPreviousUI","activeButton","setButtonColor","button","color","node"],"mappings":"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","sourcesContent":["import { _decorator, Button, Color, color, Component, director, instantiate, Label, Node, Prefab, resources, RichText, Sprite, SpriteFrame, UITransform } from 'cc';\r\nimport { UIStackManager } from '../UIStackManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('NavigationBar')\r\nexport class NavigationBar extends Component {\r\n    @property(Node)\r\n    homePanel: Node = null;\r\n\r\n    @property(Node)\r\n    ingredientSearchPanel: Node = null;\r\n\r\n    @property(Node)\r\n    randomRecipePanel: Node = null\r\n    @property(Node)\r\n    navBar: Node = null;\r\n\r\n    @property(Node)\r\n    detailPage: Node = null;\r\n    @property(Node)\r\n    content: Node = null;\r\n    @property(Prefab)\r\n    RecipeDetail: Node = null;\r\n    @property(Prefab)\r\n    RichText: Node = null;\r\n    @property(Prefab)\r\n    Foodimage: Node = null;\r\n    @property(Button)\r\n    homeButton: Button = null;\r\n\r\n    @property(Button)\r\n    ingredientSearchButton: Button = null;\r\n\r\n    @property(Button)\r\n    randomRecipeButton: Button = null;\r\n\r\n    // 当前活动按钮的颜色\r\n    activeColor: Color = new Color(0, 224, 255); // 00E0FF \r\n    // 默认按钮颜色\r\n    defaultColor: Color = new Color(255, 255, 255);  // 默认颜色为白色\r\n\r\n    onLoad() {\r\n        this.goToHome();\r\n    }\r\n\r\n    goToHome() {\r\n        // 切换到主页逻辑并高亮按钮\r\n        UIStackManager.instance.popUI();\r\n        UIStackManager.instance.pushUI(this.homePanel);\r\n        this.homePanel.active = true;\r\n        this.ingredientSearchPanel.active = false;\r\n        this.randomRecipePanel.active = false;\r\n        this.highlightButton(this.homeButton);\r\n    }\r\n\r\n    goToIngredientSearch() {\r\n        // 切换到食材检索页面逻辑并高亮按钮\r\n        UIStackManager.instance.popUI();\r\n        UIStackManager.instance.pushUI(this.ingredientSearchPanel);\r\n        this.homePanel.active = false;\r\n        this.ingredientSearchPanel.active = true;\r\n        this.randomRecipePanel.active = false;\r\n        this.highlightButton(this.ingredientSearchButton);\r\n    }\r\n\r\n    goToRandomRecipe() {\r\n        // 切换到随机食谱页面逻辑并高亮按钮\r\n        UIStackManager.instance.popUI();\r\n        UIStackManager.instance.pushUI(this.randomRecipePanel);\r\n        this.homePanel.active = false;\r\n        this.ingredientSearchPanel.active = false;\r\n        this.randomRecipePanel.active = true;\r\n        this.highlightButton(this.randomRecipeButton);\r\n    }\r\n    // 进入详情页面\r\n    goToDetailPage(recipe : any) {\r\n        // 清空当前列表\r\n        this.content.removeAllChildren();\r\n        UIStackManager.instance.pushUI(this.detailPage);\r\n        this.detailPage.active = true;\r\n        this.homePanel.active = false;\r\n        this.ingredientSearchPanel.active = false;\r\n        this.randomRecipePanel.active = false;\r\n        // 实例化节点\r\n        const RecipeListitem = instantiate(this.RecipeDetail);\r\n        const Fiamge = instantiate(this.Foodimage);\r\n        const Rtext1 = instantiate(this.RichText);\r\n        const Rtext2 = instantiate(this.RichText);\r\n        // 设置食谱内容\r\n        RecipeListitem.getChildByName(\"NameLabel\").getComponent(Label).string = recipe.name;\r\n        RecipeListitem.getChildByName(\"IngredientsLabel\").getComponent(Label).string = `食材：${recipe.ingredients.join(\",\")}`;\r\n        if(recipe.seasonings != \"\")\r\n          RecipeListitem.getChildByName(\"SeasoningsLabel\").getComponent(Label).string = `配料：${recipe.seasonings.join(\",\")}`;\r\n        else {RecipeListitem.getChildByName(\"SeasoningsLabel\").getComponent(Label).string = `配料：无`;}\r\n        RecipeListitem.getChildByName(\"CookingMethodsLabel\").getComponent(Label).string = `烹饪方式：${recipe.cooking_methods.join(\" 或 \")}`;\r\n        // 加载并设置图片\r\n        resources.load(recipe.image, SpriteFrame, (err, spriteFrame) => {\r\n            if (err) {\r\n                console.error(\"Failed to load image:\", err);\r\n                return;\r\n            }\r\n            // 获取 Sprite 组件并设置 spriteFrame\r\n            const sprite = Fiamge.getComponent(Sprite);\r\n            if (sprite) {\r\n                sprite.spriteFrame = spriteFrame;\r\n\r\n                // 获取图片的原始尺寸\r\n                const texture = spriteFrame.texture;\r\n                const originalWidth = texture.width;\r\n                const originalHeight = texture.height;\r\n\r\n                // 获取并调整 UITransform 的尺寸\r\n                const uiTransform = Fiamge.getComponent(UITransform);\r\n                if (uiTransform) {\r\n                    uiTransform.setContentSize(originalWidth*0.5, originalHeight*0.5);\r\n                }\r\n            }\r\n        }); \r\n        Rtext1.getComponent(RichText).string = recipe.link;\r\n        Rtext1.getComponent(RichText).horizontalAlign = 1 ;//内容居中\r\n        // 使用 TOUCH_END 监听点击事件\r\n        Rtext1.on(Node.EventType.TOUCH_END, (event) => {\r\n            const link = this.extractLinkFromRichText(Rtext1.getComponent(RichText).string);\r\n            if (link) {\r\n                console.log(\"超链接被点击:\", link);\r\n                if (typeof window !== 'undefined') {\r\n                    window.open(link, '_blank');\r\n                }\r\n            }\r\n        });\r\n        Rtext2.getComponent(RichText).string = recipe.details;\r\n        this.detailPage.addChild(RecipeListitem);\r\n        this.content.addChild(Fiamge);\r\n        this.content.addChild(Rtext1);\r\n        this.content.addChild(Rtext2);\r\n        // 更新滚动视图内容尺寸\r\n        this.scheduleOnce(() => {\r\n            const contentUITransform = this.content.getComponent(UITransform);\r\n            contentUITransform.height = this.content.children.reduce((acc, child) => acc + child.getComponent(UITransform).height, 0);\r\n        }, 0);\r\n    }\r\n    extractLinkFromRichText(richTextString: string): string | null {\r\n        // 使用正则表达式匹配 href 属性并提取链接\r\n        const match = richTextString.match(/href=\"([^\"]+)\"/);\r\n        return match ? match[1] : null;\r\n    }\r\n    // 返回上一个UI\r\n    goBackToPreviousUI() {\r\n        this.detailPage.active = false;\r\n        this.homePanel.active = false;\r\n        this.ingredientSearchPanel.active = false;\r\n        this.randomRecipePanel.active = false;\r\n        UIStackManager.instance.popUI().active = true;  \r\n    }\r\n    // 设置按钮高亮，并将其他按钮恢复默认颜色\r\n    highlightButton(activeButton: Button) {\r\n        // 重置所有按钮的颜色\r\n        this.setButtonColor(this.homeButton, this.defaultColor);\r\n        this.setButtonColor(this.ingredientSearchButton, this.defaultColor);\r\n        this.setButtonColor(this.randomRecipeButton, this.defaultColor);\r\n\r\n        // 设置当前按钮为高亮颜色\r\n        this.setButtonColor(activeButton, this.activeColor);\r\n    }\r\n    setButtonColor(button: Button, color: Color) {\r\n        const sprite = button.node.getComponent(Sprite);\r\n        if (sprite) {\r\n            sprite.color = color;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}